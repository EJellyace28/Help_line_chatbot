{% load static %}<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Chat - Calm Companion</title><link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}"><script src="https://cdn.tailwindcss.com"></script><script>tailwind.config={theme:{extend:{colors:{calm:{50:'#f0fdf4',100:'#dcfce7',200:'#bbf7d0',300:'#86efac',400:'#4ade80',500:'#22c55e',600:'#16a34a',700:'#15803d',800:'#166534',900:'#14532d'}}}}}</script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>*{font-family:'Inter',sans-serif}:root{--bg-primary:#0a0e17;--bg-secondary:#0f1629;--accent-1:#a855f7;--accent-2:#ec4899;--accent-3:#22c55e;--glass-bg:rgba(255,255,255,0.03);--glass-border:rgba(255,255,255,0.08)}[data-theme="ocean"]{--bg-primary:#0c1929;--bg-secondary:#0f2942;--accent-1:#0ea5e9;--accent-2:#06b6d4;--accent-3:#14b8a6}[data-theme="forest"]{--bg-primary:#0a1a0f;--bg-secondary:#0f2918;--accent-1:#22c55e;--accent-2:#10b981;--accent-3:#84cc16}[data-theme="sunset"]{--bg-primary:#1a0f0a;--bg-secondary:#291810;--accent-1:#f97316;--accent-2:#f43f5e;--accent-3:#eab308}body{background:linear-gradient(135deg,var(--bg-primary) 0%,var(--bg-secondary) 50%,var(--bg-primary) 100%);min-height:100vh;opacity:0;animation:pageIn 0.15s ease forwards}.glass{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border)}.gradient-accent{background:linear-gradient(135deg,var(--accent-1),var(--accent-2))}.glow{box-shadow:0 0 40px color-mix(in srgb,var(--accent-1) 30%,transparent)}.btn-glow:hover{box-shadow:0 0 30px color-mix(in srgb,var(--accent-1) 40%,transparent)}.orb{position:fixed;border-radius:50%;filter:blur(100px);z-index:0;pointer-events:none;animation:float 20s ease-in-out infinite}.orb-1{background:radial-gradient(circle,color-mix(in srgb,var(--accent-1) 20%,transparent),transparent 70%)}.orb-2{background:radial-gradient(circle,color-mix(in srgb,var(--accent-2) 15%,transparent),transparent 70%)}.orb-3{background:radial-gradient(circle,color-mix(in srgb,var(--accent-3) 10%,transparent),transparent 70%)}@keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,-30px)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-4px)}}@keyframes pageIn{from{opacity:0}to{opacity:1}}@keyframes pageOut{from{opacity:1}to{opacity:0}}@keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}@keyframes sadBounce{0%,100%{transform:translateY(0)}25%{transform:translateY(-8px)}50%{transform:translateY(0)}75%{transform:translateY(-4px)}}.page-exit{animation:pageOut 0.1s ease forwards}.modal-enter{animation:modalIn 0.15s ease forwards}.animate-fadeUp{animation:fadeUp 0.3s ease-out}.animate-pulse-slow{animation:pulse 2s ease-in-out infinite}.breathing-circle{transition:transform 4s ease-in-out,opacity 0.5s}.reaction-btn{opacity:0;transition:opacity 0.2s}.message-wrapper:hover .reaction-btn{opacity:1}.scroll-btn{transition:opacity 0.2s,transform 0.2s}.scroll-btn:hover{transform:scale(1.1)}.sad-emoji{animation:sadBounce 1.5s ease-in-out infinite}.confetti{animation:confetti 0.5s ease-out}@keyframes confetti{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(-20px) rotate(360deg)}}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:color-mix(in srgb,var(--accent-1) 30%,transparent);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:color-mix(in srgb,var(--accent-1) 50%,transparent)}</style></head><body class="text-white overflow-hidden"><!-- Emoji Picker --><div id="emojiPicker" class="fixed bottom-24 left-[340px] z-40 hidden"><div class="glass rounded-2xl p-4 modal-enter"><p class="text-xs text-gray-400 uppercase tracking-wider mb-3">Quick Emojis</p><div class="grid grid-cols-6 gap-2"><button onclick="insertEmoji('ğŸ˜Š')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ˜Š</button><button onclick="insertEmoji('â¤ï¸')" class="text-2xl hover:scale-125 transition-transform p-1">â¤ï¸</button><button onclick="insertEmoji('ğŸ™')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ™</button><button onclick="insertEmoji('ğŸ’ª')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ’ª</button><button onclick="insertEmoji('âœ¨')" class="text-2xl hover:scale-125 transition-transform p-1">âœ¨</button><button onclick="insertEmoji('ğŸŒŸ')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸŒŸ</button><button onclick="insertEmoji('ğŸ’œ')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ’œ</button><button onclick="insertEmoji('ğŸ¤—')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ¤—</button><button onclick="insertEmoji('ğŸ˜Œ')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ˜Œ</button><button onclick="insertEmoji('ğŸ¥°')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ¥°</button><button onclick="insertEmoji('ğŸ’–')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸ’–</button><button onclick="insertEmoji('ğŸŒˆ')" class="text-2xl hover:scale-125 transition-transform p-1">ğŸŒˆ</button></div></div></div><!-- Logout Confirmation Modal --><div id="logoutModal" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeLogoutModal()"></div><div class="relative glass rounded-3xl p-8 max-w-md mx-4 modal-enter"><div class="text-center"><div class="text-7xl mb-6 sad-emoji">ğŸ˜¢</div><h3 class="text-xl font-bold text-white mb-2">Leaving so soon?</h3><p class="text-gray-400 mb-8">We'll miss you! Are you sure you want to logout?</p><div class="flex gap-4"><button onclick="closeLogoutModal()" class="flex-1 py-3 px-6 rounded-xl gradient-accent text-white font-medium transition-all">Stay with me ğŸ’œ</button><button onclick="confirmLogout()" class="flex-1 py-3 px-6 rounded-xl border border-white/10 text-gray-300 hover:bg-white/5 transition-all font-medium">Yes, logout</button></div></div></div></div><!-- Scroll to Bottom Button --><button id="scrollBtn" onclick="scrollToBottom()" class="fixed bottom-28 right-8 z-30 w-12 h-12 rounded-full gradient-accent shadow-lg scroll-btn opacity-0 pointer-events-none flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg></button><!-- Gratitude Journal Modal --><div id="journalModal" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeJournalModal()"></div><div class="relative glass rounded-3xl p-8 max-w-lg w-full mx-4 modal-enter"><button onclick="closeJournalModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button><div class="text-center mb-6"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl gradient-accent flex items-center justify-center text-3xl">ğŸ“</div><h3 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Gratitude Journal</h3><p class="text-gray-400 mt-2">What are you grateful for today?</p></div><div id="journalView"><textarea id="journalInput" rows="4" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 resize-none focus:outline-none focus:border-purple-500/50" placeholder="I'm grateful for..."></textarea><button onclick="saveJournal()" class="w-full mt-4 py-3 gradient-accent rounded-xl text-white font-semibold hover:opacity-90 transition-all">Save Entry (+10 points â­)</button></div><div id="journalHistory" class="hidden"><div class="max-h-64 overflow-y-auto space-y-3" id="journalEntries"></div><button onclick="showJournalInput()" class="w-full mt-4 py-3 gradient-accent rounded-xl text-white font-semibold">+ New Entry</button></div><div class="flex justify-center gap-4 mt-4"><button onclick="showJournalInput()" class="text-sm text-gray-400 hover:text-white" id="btnWrite">Write</button><button onclick="showJournalHistory()" class="text-sm text-gray-400 hover:text-white" id="btnHistory">History</button></div></div></div><!-- Insights Modal --><div id="insightsModal" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeInsightsModal()"></div><div class="relative glass rounded-3xl p-8 max-w-lg w-full mx-4 modal-enter"><button onclick="closeInsightsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button><div class="text-center mb-6"><div class="w-16 h-16 mx-auto mb-4 rounded-2xl gradient-accent flex items-center justify-center text-3xl">ğŸ“Š</div><h3 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Your Insights</h3></div><div class="space-y-4"><div class="glass rounded-xl p-4"><div class="flex items-center justify-between"><span class="text-gray-400">Messages Sent</span><span class="text-2xl font-bold" id="insightMessages">0</span></div></div><div class="glass rounded-xl p-4"><div class="flex items-center justify-between"><span class="text-gray-400">Mood Check-ins</span><span class="text-2xl font-bold" id="insightMoods">0</span></div></div><div class="glass rounded-xl p-4"><div class="flex items-center justify-between"><span class="text-gray-400">Journal Entries</span><span class="text-2xl font-bold" id="insightJournals">0</span></div></div><div class="glass rounded-xl p-4"><div class="flex items-center justify-between"><span class="text-gray-400">Breathing Sessions</span><span class="text-2xl font-bold" id="insightBreaths">0</span></div></div><div class="glass rounded-xl p-4"><div class="text-gray-400 mb-2">Mood Trend</div><div class="flex justify-between items-end h-16" id="moodChart"></div></div></div></div></div><!-- Crisis Support Modal --><div id="crisisModal" class="fixed inset-0 z-[60] hidden items-center justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div><div class="relative glass rounded-3xl p-8 max-w-lg mx-4 modal-enter text-center border-2 border-red-500/30"><div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center text-4xl">ğŸ’™</div><h3 class="text-2xl font-bold text-white mb-2">We're Here For You</h3><p class="text-gray-300 mb-6">It sounds like you might be going through a difficult time. Please know that help is available.</p><div class="glass rounded-xl p-4 mb-6 text-left space-y-3"><p class="text-sm font-medium text-white">ğŸ‡µğŸ‡­ Philippines Crisis Hotlines:</p><div class="text-sm text-gray-300 space-y-2"><p>ğŸ“ <strong>NCMH:</strong> 0917-899-8727</p><p>ğŸ“ <strong>Hopeline:</strong> 2919</p><p>ğŸ“ <strong>In Touch:</strong> (02) 8893-7603</p></div></div><div class="flex gap-3"><button onclick="closeCrisisModal()" class="flex-1 py-3 px-6 rounded-xl border border-white/10 text-gray-300 hover:bg-white/5 transition-all font-medium">I'm okay</button><a href="tel:09178998727" class="flex-1 py-3 px-6 rounded-xl bg-gradient-to-r from-red-500 to-pink-600 text-white font-medium text-center">Call Now</a></div></div></div><!-- Daily Affirmation Popup --><div id="affirmationPopup" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAffirmation()"></div><div class="relative glass rounded-3xl p-10 max-w-lg mx-4 modal-enter text-center"><div class="w-16 h-16 mx-auto mb-6 rounded-2xl gradient-accent flex items-center justify-center text-3xl">âœ¨</div><p class="text-xs text-gray-400 uppercase tracking-wider mb-4">Daily Affirmation</p><p id="affirmationText" class="text-2xl font-medium leading-relaxed mb-8 bg-gradient-to-r from-purple-300 to-pink-300 bg-clip-text text-transparent"></p><button onclick="closeAffirmation()" class="px-8 py-3 rounded-xl gradient-accent text-white font-semibold hover:opacity-90 transition-all">I'm Ready ğŸ’ª</button></div></div><!-- Delete Confirmation Modal --><div id="deleteModal" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDeleteModal()"></div><div class="relative glass rounded-3xl p-8 max-w-md mx-4 modal-enter"><div class="text-center"><div class="w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></div><h3 class="text-xl font-bold text-white mb-2">Delete Conversation?</h3><p class="text-gray-400 mb-8">This action cannot be undone.</p><div class="flex gap-4"><button onclick="closeDeleteModal()" class="flex-1 py-3 px-6 rounded-xl border border-white/10 text-gray-300 hover:bg-white/5 transition-all font-medium">Cancel</button><button onclick="confirmDelete()" class="flex-1 py-3 px-6 rounded-xl bg-gradient-to-r from-red-500 to-pink-600 text-white font-medium transition-all">Delete</button></div></div></div></div><!-- Breathing Modal --><div id="breathingModal" class="fixed inset-0 z-50 hidden items-center justify-center"><div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeBreathingModal()"></div><div class="relative glass rounded-3xl p-10 max-w-lg mx-4 modal-enter text-center"><button onclick="closeBreathingModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button><h3 class="text-2xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Breathing Exercise</h3><p class="text-gray-400 mb-8">Follow the circle. Breathe in as it expands.</p><div class="relative w-48 h-48 mx-auto mb-8"><div class="absolute inset-0 rounded-full gradient-accent opacity-20 blur-xl"></div><div id="breathingCircle" class="absolute inset-4 rounded-full gradient-accent flex items-center justify-center breathing-circle scale-[0.6]"><span id="breathingText" class="text-white font-semibold text-lg">Ready</span></div></div><div class="flex items-center justify-center gap-6"><button id="breathingStartBtn" onclick="toggleBreathing()" class="px-8 py-3 rounded-xl gradient-accent text-white font-semibold">Start</button><div class="text-gray-400"><span id="breathingCount">0</span> breaths</div></div></div></div><!-- Theme Picker --><div id="themePicker" class="fixed top-20 right-4 z-40 hidden"><div class="glass rounded-2xl p-4 space-y-3 modal-enter"><p class="text-xs text-gray-400 uppercase tracking-wider mb-2">Theme</p><button onclick="setTheme('dark')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5 transition-all"><span class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500"></span><span class="text-sm">Dark</span></button><button onclick="setTheme('ocean')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5 transition-all"><span class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500"></span><span class="text-sm">Ocean</span></button><button onclick="setTheme('forest')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5 transition-all"><span class="w-6 h-6 rounded-full bg-gradient-to-br from-green-500 to-emerald-500"></span><span class="text-sm">Forest</span></button><button onclick="setTheme('sunset')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5 transition-all"><span class="w-6 h-6 rounded-full bg-gradient-to-br from-orange-500 to-rose-500"></span><span class="text-sm">Sunset</span></button></div></div><!-- Sound Picker --><div id="soundPicker" class="fixed top-20 right-16 z-40 hidden"><div class="glass rounded-2xl p-4 space-y-3 modal-enter"><p class="text-xs text-gray-400 uppercase tracking-wider mb-2">Sounds</p><button onclick="playSound('rain')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5" id="sound-rain"><span>ğŸŒ§ï¸</span><span class="text-sm">Rain</span></button><button onclick="playSound('ocean')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5" id="sound-ocean"><span>ğŸŒŠ</span><span class="text-sm">Ocean</span></button><button onclick="playSound('wind')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5" id="sound-wind"><span>ğŸƒ</span><span class="text-sm">Wind</span></button><button onclick="playSound('white')" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5" id="sound-white"><span>â˜ï¸</span><span class="text-sm">White Noise</span></button><div class="border-t border-white/10 pt-3 mt-3"><button onclick="stopSound()" class="w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/5 text-red-400"><span>â¹ï¸</span><span class="text-sm">Stop</span></button></div></div></div><div class="orb orb-1 w-96 h-96 -top-48 -left-48"></div><div class="orb orb-2 w-80 h-80 -bottom-40 -right-40" style="animation-delay:-10s"></div><div class="orb orb-3 w-64 h-64 top-1/2 left-1/3" style="animation-delay:-5s"></div><div class="flex h-screen relative z-10"><aside class="w-80 glass border-r border-white/5 flex flex-col"><div class="p-6 border-b border-white/5"><button onclick="createNewChat()" class="w-full py-4 px-6 gradient-accent hover:opacity-90 rounded-2xl font-semibold text-white shadow-lg btn-glow transition-all flex items-center justify-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>New Chat</button></div><div class="px-4 pt-4 space-y-3"><div class="glass rounded-xl p-4 flex items-center gap-4"><div class="text-3xl">â­</div><div><p class="text-2xl font-bold" id="pointsCount">0</p><p class="text-xs text-gray-400">Calm Points</p></div><div class="ml-auto"><span class="text-xs px-2 py-1 rounded-full gradient-accent" id="levelBadge">Beginner</span></div></div><div class="glass rounded-xl p-4 flex items-center gap-4"><div class="text-3xl">ğŸ”¥</div><div><p class="text-2xl font-bold" id="streakCount">0</p><p class="text-xs text-gray-400">Day Streak</p></div><button onclick="openJournalModal()" class="ml-auto p-2 rounded-lg hover:bg-white/5" title="Gratitude Journal"><span class="text-xl">ğŸ“</span></button><button onclick="openInsightsModal()" class="p-2 rounded-lg hover:bg-white/5" title="Insights"><span class="text-xl">ğŸ“Š</span></button></div></div><div class="flex-1 overflow-y-auto p-4 space-y-2">{% if chats %}<p class="text-xs text-gray-500 uppercase tracking-wider px-3 py-2 font-medium">Recent Chats</p>{% for chat in chats %}<div onclick="loadChat({{ chat.id }})" class="group flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all hover:bg-white/5 {% if current_chat and chat.id == current_chat.id %}bg-white/5 border border-white/10{% else %}border border-transparent{% endif %}"><span class="text-sm text-gray-300 truncate flex-1">{{ chat.title }}</span><button onclick="event.stopPropagation();showDeleteModal({{ chat.id }})" class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 p-1 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>{% endfor %}{% else %}<div class="text-center py-12 text-gray-500"><svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg><p class="text-sm">No conversations yet</p></div>{% endif %}</div><div class="p-4 border-t border-white/5"><div class="glass rounded-xl p-4 mb-4"><p class="text-xs text-gray-400 uppercase tracking-wider mb-3">How are you feeling?</p><div class="flex justify-between" id="moodPicker"><button onclick="setMood(1)" class="text-2xl hover:scale-125 transition-transform">ğŸ˜¢</button><button onclick="setMood(2)" class="text-2xl hover:scale-125 transition-transform">ğŸ˜•</button><button onclick="setMood(3)" class="text-2xl hover:scale-125 transition-transform">ğŸ˜</button><button onclick="setMood(4)" class="text-2xl hover:scale-125 transition-transform">ğŸ™‚</button><button onclick="setMood(5)" class="text-2xl hover:scale-125 transition-transform">ğŸ˜Š</button></div><p id="lastMood" class="text-xs text-gray-500 mt-3 text-center"></p></div><div onclick="showLogoutModal()" class="flex items-center gap-4 p-4 rounded-xl glass hover:bg-white/5 transition-all cursor-pointer"><div class="w-12 h-12 rounded-xl gradient-accent flex items-center justify-center font-bold text-lg shadow-lg">{{ user_name|slice:":1"|upper }}</div><div class="flex-1"><p class="font-medium text-white">{{ user_name }}</p><p class="text-xs text-gray-400">Logout</p></div></div></div></aside><main class="flex-1 flex flex-col"><header class="px-8 py-5 glass border-b border-white/5 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg></div><div><h1 class="text-lg font-semibold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Calm Companion</h1><div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse-slow"></span><span class="text-xs text-gray-400">AI</span><span id="soundIndicator" class="hidden text-xs text-purple-400 ml-2">ğŸµ</span></div></div></div><div class="flex items-center gap-2"><button onclick="toggleSoundPicker()" class="p-3 rounded-xl glass hover:bg-white/5" title="Sounds"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg></button><button onclick="openBreathingModal()" class="p-3 rounded-xl glass hover:bg-white/5" title="Breathe"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg></button><button onclick="toggleThemePicker()" class="p-3 rounded-xl glass hover:bg-white/5" title="Theme"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg></button></div></header><div id="chatMessages" class="flex-1 overflow-y-auto p-8 space-y-6">{% if messages %}{% for message in messages %}<div class="message-wrapper flex gap-4 max-w-4xl mx-auto w-full animate-fadeUp {% if message.sender == 'user' %}justify-end{% endif %}">{% if message.sender != 'user' %}<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 shadow-lg"><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg></div>{% endif %}<div class="relative group"><div class="{% if message.sender == 'user' %}gradient-accent rounded-2xl rounded-tr-md{% else %}glass rounded-2xl rounded-tl-md{% endif %} p-5 max-w-xl"><p class="text-sm leading-relaxed">{{ message.content }}</p><p class="text-[10px] text-gray-500 mt-2 text-right">{{ message.timestamp|date:"g:i A" }}</p></div>{% if message.sender != 'user' %}<div class="reaction-btn absolute -bottom-3 left-4 flex gap-1 glass rounded-full px-2 py-1"><button onclick="react(this,'â¤ï¸')" class="hover:scale-125 text-sm">â¤ï¸</button><button onclick="react(this,'ğŸ‘')" class="hover:scale-125 text-sm">ğŸ‘</button><button onclick="react(this,'â­')" class="hover:scale-125 text-sm">â­</button><button onclick="react(this,'ğŸ™')" class="hover:scale-125 text-sm">ğŸ™</button></div>{% endif %}</div>{% if message.sender == 'user' %}<div class="w-10 h-10 rounded-xl gradient-accent flex items-center justify-center flex-shrink-0 font-bold shadow-lg">{{ user_name|slice:":1"|upper }}</div>{% endif %}</div>{% endfor %}{% else %}<div class="flex-1 flex flex-col items-center justify-center text-center animate-fadeUp"><div class="w-24 h-24 rounded-3xl gradient-accent flex items-center justify-center mb-8 shadow-2xl glow"><svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg></div><h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-cyan-400 bg-clip-text text-transparent">Hi {{ user_name }}!</h1><p class="text-gray-400 max-w-md text-lg">I'm your Calm Companion, here to listen and support you.</p></div>{% endif %}<div id="typingIndicator" class="hidden gap-4 max-w-4xl mx-auto w-full"><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg></div><div class="glass rounded-2xl rounded-tl-md p-5"><div class="flex gap-1"><span class="w-2 h-2 rounded-full bg-purple-400" style="animation:bounce 1.4s infinite"></span><span class="w-2 h-2 rounded-full bg-purple-400" style="animation:bounce 1.4s infinite 0.2s"></span><span class="w-2 h-2 rounded-full bg-purple-400" style="animation:bounce 1.4s infinite 0.4s"></span></div></div></div></div><div class="p-6 glass border-t border-white/5"><div class="max-w-4xl mx-auto relative flex gap-3"><button id="emojiBtn" onclick="toggleEmojiPicker()" class="w-12 h-12 glass rounded-xl flex items-center justify-center text-2xl hover:bg-white/5" title="Emoji">ğŸ˜Š</button><div class="flex-1 relative"><textarea id="chatInput" rows="1" placeholder="Share what's on your mind..." class="w-full px-6 py-4 pr-16 bg-white/5 border border-white/10 rounded-2xl text-white placeholder-gray-500 resize-none focus:outline-none focus:border-purple-500/50 focus:ring-2 focus:ring-purple-500/20"></textarea><button id="sendBtn" disabled class="absolute right-3 bottom-3 w-10 h-10 gradient-accent rounded-xl flex items-center justify-center text-white disabled:opacity-30 disabled:cursor-not-allowed"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg></button></div></div></div></main></div><script>const chatInput=document.getElementById("chatInput"),sendBtn=document.getElementById("sendBtn"),chatMessages=document.getElementById("chatMessages"),typingIndicator=document.getElementById("typingIndicator"),deleteModal=document.getElementById("deleteModal"),logoutModal=document.getElementById("logoutModal"),breathingModal=document.getElementById("breathingModal"),crisisModal=document.getElementById("crisisModal"),journalModal=document.getElementById("journalModal"),insightsModal=document.getElementById("insightsModal"),themePicker=document.getElementById("themePicker"),soundPicker=document.getElementById("soundPicker"),emojiPicker=document.getElementById("emojiPicker"),affirmationPopup=document.getElementById("affirmationPopup"),scrollBtn=document.getElementById("scrollBtn"),currentChatId={% if current_chat %}{{ current_chat.id }}{% else %}null{% endif %},userName="{{ user_name|slice:':1'|upper }}",logoutUrl="{% url 'logout' %}";let chatToDelete=null,isBreathing=false,breathingInterval=null,breathCount=0,audioContext=null,currentSoundNode=null,currentSound=null;const affirmations=["You are worthy of love.","I choose peace over worry.","I am stronger than I think.","Every breath calms me.","I release what I cannot control.","I am doing my best.","I deserve happiness.","My feelings are valid.","I am growing every day.","I am resilient."];const crisisKeywords=["suicide","kill myself","want to die","end my life","self harm","hurt myself"];function getCookie(n){let c=null;if(document.cookie)for(let k of document.cookie.split(";")){k=k.trim();if(k.startsWith(n+"="))c=decodeURIComponent(k.substring(n.length+1))}return c}const csrftoken=getCookie("csrftoken");function toggleEmojiPicker(){emojiPicker.classList.toggle("hidden");themePicker.classList.add("hidden");soundPicker.classList.add("hidden")}function insertEmoji(emoji){chatInput.value+=emoji;chatInput.focus();sendBtn.disabled=!chatInput.value.trim();emojiPicker.classList.add("hidden")}function showLogoutModal(){logoutModal.classList.remove("hidden");logoutModal.classList.add("flex")}function closeLogoutModal(){logoutModal.classList.add("hidden");logoutModal.classList.remove("flex")}function confirmLogout(){closeLogoutModal();document.body.classList.add("page-exit");setTimeout(()=>{location.href=logoutUrl},100)}chatMessages.addEventListener("scroll",function(){const isNearBottom=chatMessages.scrollHeight-chatMessages.scrollTop-chatMessages.clientHeight<100;if(isNearBottom){scrollBtn.classList.add("opacity-0","pointer-events-none");scrollBtn.classList.remove("opacity-100","pointer-events-auto")}else{scrollBtn.classList.remove("opacity-0","pointer-events-none");scrollBtn.classList.add("opacity-100","pointer-events-auto")}});function typeMessage(element,text,speed=20){let i=0;element.textContent="";function type(){if(i<text.length){element.textContent+=text.charAt(i);i++;setTimeout(type,speed)}};type()}function getPoints(){return parseInt(localStorage.getItem("calmPoints")||"0")}function addPoints(n){const p=getPoints()+n;localStorage.setItem("calmPoints",p);updatePointsDisplay()}function updatePointsDisplay(){const p=getPoints();document.getElementById("pointsCount").textContent=p;const levels=[{min:0,name:"Beginner"},{min:50,name:"Explorer"},{min:150,name:"Warrior"},{min:300,name:"Master"},{min:500,name:"Legend"}];let lvl=levels[0];for(const l of levels)if(p>=l.min)lvl=l;document.getElementById("levelBadge").textContent=lvl.name}updatePointsDisplay();function openJournalModal(){journalModal.classList.remove("hidden");journalModal.classList.add("flex");showJournalInput()}function closeJournalModal(){journalModal.classList.add("hidden");journalModal.classList.remove("flex")}function showJournalInput(){document.getElementById("journalView").classList.remove("hidden");document.getElementById("journalHistory").classList.add("hidden")}function showJournalHistory(){document.getElementById("journalView").classList.add("hidden");document.getElementById("journalHistory").classList.remove("hidden");const entries=JSON.parse(localStorage.getItem("journalEntries")||"[]");const container=document.getElementById("journalEntries");if(entries.length===0){container.innerHTML='<p class="text-gray-500 text-center py-8">No entries yet</p>'}else{container.innerHTML=entries.slice(-10).reverse().map(e=>`<div class="glass rounded-xl p-4"><p class="text-sm">${e.text}</p><p class="text-xs text-gray-500 mt-2">${new Date(e.date).toLocaleDateString()}</p></div>`).join("")}}function saveJournal(){const text=document.getElementById("journalInput").value.trim();if(!text)return;const entries=JSON.parse(localStorage.getItem("journalEntries")||"[]");entries.push({text,date:new Date().toISOString()});localStorage.setItem("journalEntries",JSON.stringify(entries));document.getElementById("journalInput").value="";addPoints(10);closeJournalModal();showConfetti()}function showConfetti(){const c=document.createElement("div");c.innerHTML="ğŸ‰";c.className="fixed top-1/2 left-1/2 text-6xl confetti";document.body.appendChild(c);setTimeout(()=>c.remove(),600)}function openInsightsModal(){insightsModal.classList.remove("hidden");insightsModal.classList.add("flex");const stats=JSON.parse(localStorage.getItem("calmStats")||'{"messages":0,"moods":0,"breaths":0}');const journals=JSON.parse(localStorage.getItem("journalEntries")||"[]");document.getElementById("insightMessages").textContent=stats.messages;document.getElementById("insightMoods").textContent=stats.moods;document.getElementById("insightJournals").textContent=journals.length;document.getElementById("insightBreaths").textContent=stats.breaths;const moodHistory=JSON.parse(localStorage.getItem("moodHistory")||"[]").slice(-7);const chart=document.getElementById("moodChart");chart.innerHTML=moodHistory.map(m=>`<div class="w-4 bg-purple-500/50 rounded-t" style="height:${m*20}%"></div>`).join("")||'<p class="text-gray-500 text-sm">No mood data</p>'}function closeInsightsModal(){insightsModal.classList.add("hidden");insightsModal.classList.remove("flex")}function trackStat(key){const stats=JSON.parse(localStorage.getItem("calmStats")||'{"messages":0,"moods":0,"breaths":0}');stats[key]=(stats[key]||0)+1;localStorage.setItem("calmStats",JSON.stringify(stats))}function updateStreak(){const data=JSON.parse(localStorage.getItem("wellnessStreak")||'{"count":0,"lastDate":""}');const today=new Date().toDateString();const yesterday=new Date(Date.now()-86400000).toDateString();if(data.lastDate===today){}else if(data.lastDate===yesterday){data.count++;data.lastDate=today;localStorage.setItem("wellnessStreak",JSON.stringify(data))}else if(data.lastDate!==today){data.count=1;data.lastDate=today;localStorage.setItem("wellnessStreak",JSON.stringify(data))}document.getElementById("streakCount").textContent=data.count}updateStreak();function checkForCrisis(text){const lowerText=text.toLowerCase();for(const keyword of crisisKeywords){if(lowerText.includes(keyword)){showCrisisModal();return true}}return false}function showCrisisModal(){crisisModal.classList.remove("hidden");crisisModal.classList.add("flex")}function closeCrisisModal(){crisisModal.classList.add("hidden");crisisModal.classList.remove("flex")}function showAffirmation(){const lastShown=localStorage.getItem("lastAffirmation");const today=new Date().toDateString();if(lastShown!==today){const aff=affirmations[Math.floor(Math.random()*affirmations.length)];document.getElementById("affirmationText").textContent=aff;affirmationPopup.classList.remove("hidden");affirmationPopup.classList.add("flex");localStorage.setItem("lastAffirmation",today)}}function closeAffirmation(){affirmationPopup.classList.add("hidden");affirmationPopup.classList.remove("flex")}setTimeout(showAffirmation,500);function createNoise(type){if(!audioContext)audioContext=new(window.AudioContext||window.webkitAudioContext)();stopSound();const bufferSize=2*audioContext.sampleRate;const buffer=audioContext.createBuffer(1,bufferSize,audioContext.sampleRate);const output=buffer.getChannelData(0);if(type==="white"){for(let i=0;i<bufferSize;i++)output[i]=(Math.random()*2-1)*0.3}else if(type==="rain"){let lastOut=0;for(let i=0;i<bufferSize;i++){const white=Math.random()*2-1;output[i]=(lastOut+(0.02*white))/1.02;lastOut=output[i];output[i]*=3.5}}else if(type==="ocean"){for(let i=0;i<bufferSize;i++){const t=i/audioContext.sampleRate;output[i]=(Math.random()*2-1)*0.15*Math.abs(Math.sin(t*0.2))}}else if(type==="wind"){let lastOut=0;for(let i=0;i<bufferSize;i++){const t=i/audioContext.sampleRate;const white=Math.random()*2-1;output[i]=(lastOut+(0.1*white))/1.1;lastOut=output[i];output[i]*=2*(0.5+0.5*Math.sin(t*0.3))}}const source=audioContext.createBufferSource();source.buffer=buffer;source.loop=true;const gain=audioContext.createGain();gain.gain.value=0.4;source.connect(gain);gain.connect(audioContext.destination);source.start();currentSoundNode={source,gain};currentSound=type;document.getElementById("soundIndicator").classList.remove("hidden");soundPicker.classList.add("hidden")}function toggleSoundPicker(){soundPicker.classList.toggle("hidden");themePicker.classList.add("hidden");emojiPicker.classList.add("hidden")}function playSound(type){createNoise(type)}function stopSound(){if(currentSoundNode){currentSoundNode.source.stop();currentSoundNode=null}currentSound=null;document.getElementById("soundIndicator").classList.add("hidden")}function react(btn,emoji){const container=btn.parentElement;container.innerHTML=`<span class="text-sm">${emoji}</span>`}function setTheme(theme){document.documentElement.setAttribute("data-theme",theme==="dark"?"":theme);localStorage.setItem("theme",theme);themePicker.classList.add("hidden")}function toggleThemePicker(){themePicker.classList.toggle("hidden");soundPicker.classList.add("hidden");emojiPicker.classList.add("hidden")}function loadTheme(){const t=localStorage.getItem("theme")||"dark";if(t!=="dark")document.documentElement.setAttribute("data-theme",t)}loadTheme();function setMood(level){const moods=["","ğŸ˜¢","ğŸ˜•","ğŸ˜","ğŸ™‚","ğŸ˜Š"];localStorage.setItem("lastMood",JSON.stringify({level,emoji:moods[level],time:new Date().toISOString()}));const history=JSON.parse(localStorage.getItem("moodHistory")||"[]");history.push(level);if(history.length>30)history.shift();localStorage.setItem("moodHistory",JSON.stringify(history));updateMoodDisplay();addPoints(5);trackStat("moods");const btn=document.querySelectorAll("#moodPicker button")[level-1];btn.classList.add("scale-150");setTimeout(()=>btn.classList.remove("scale-150"),200)}function updateMoodDisplay(){const data=JSON.parse(localStorage.getItem("lastMood"));if(data){const diff=Math.floor((Date.now()-new Date(data.time))/60000);let ago=diff<1?"now":diff<60?diff+"m":Math.floor(diff/60)+"h";document.getElementById("lastMood").textContent=`${data.emoji} ${ago}`}}updateMoodDisplay();function openBreathingModal(){breathingModal.classList.remove("hidden");breathingModal.classList.add("flex")}function closeBreathingModal(){stopBreathing();breathingModal.classList.add("hidden");breathingModal.classList.remove("flex");if(breathCount>0){addPoints(breathCount*2);trackStat("breaths")}}function toggleBreathing(){if(isBreathing){stopBreathing()}else{startBreathing()}}function startBreathing(){isBreathing=true;document.getElementById("breathingStartBtn").textContent="Stop";breathe()}function stopBreathing(){isBreathing=false;clearTimeout(breathingInterval);document.getElementById("breathingStartBtn").textContent="Start";document.getElementById("breathingText").textContent="Ready";document.getElementById("breathingCircle").style.transform="scale(0.6)"}function breathe(){if(!isBreathing)return;const circle=document.getElementById("breathingCircle");const text=document.getElementById("breathingText");text.textContent="Breathe In";circle.style.transform="scale(1)";breathingInterval=setTimeout(()=>{if(!isBreathing)return;text.textContent="Hold";breathingInterval=setTimeout(()=>{if(!isBreathing)return;text.textContent="Breathe Out";circle.style.transform="scale(0.6)";breathingInterval=setTimeout(()=>{if(!isBreathing)return;breathCount++;document.getElementById("breathingCount").textContent=breathCount;breathe()},4000)},4000)},4000)}function showDeleteModal(id){chatToDelete=id;deleteModal.classList.remove("hidden");deleteModal.classList.add("flex")}function closeDeleteModal(){deleteModal.classList.add("hidden");deleteModal.classList.remove("flex")}async function confirmDelete(){if(!chatToDelete)return;closeDeleteModal();document.body.classList.add("page-exit");try{const r=await fetch("/api/chat/"+chatToDelete+"/delete/",{method:"DELETE",headers:{"X-CSRFToken":csrftoken}});const d=await r.json();if(d.success)setTimeout(()=>{location.href="/chat/"},100)}catch(e){document.body.classList.remove("page-exit")}}chatInput.addEventListener("input",function(){this.style.height="auto";this.style.height=Math.min(this.scrollHeight,150)+"px";sendBtn.disabled=!this.value.trim()});chatInput.addEventListener("keydown",function(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendMessage()}});sendBtn.addEventListener("click",sendMessage);function scrollToBottom(){chatMessages.scrollTop=chatMessages.scrollHeight}async function createNewChat(){document.body.classList.add("page-exit");try{const r=await fetch("/api/chat/create/",{method:"POST",headers:{"X-CSRFToken":csrftoken,"Content-Type":"application/json"}});const d=await r.json();if(d.success)setTimeout(()=>{location.href=d.redirect_url},100)}catch(e){document.body.classList.remove("page-exit")}}function getTimeString(){const now=new Date();return now.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})}async function sendMessage(){const msg=chatInput.value.trim();if(!msg)return;if(checkForCrisis(msg))return;if(!currentChatId){await createNewChat();return}const w=document.querySelector(".flex-1.flex.flex-col.items-center");if(w)w.remove();addMessage(msg,"user",getTimeString());chatInput.value="";chatInput.style.height="auto";sendBtn.disabled=true;typingIndicator.classList.remove("hidden");typingIndicator.classList.add("flex");scrollToBottom();addPoints(2);trackStat("messages");try{const r=await fetch("/api/chat/"+currentChatId+"/send/",{method:"POST",headers:{"X-CSRFToken":csrftoken,"Content-Type":"application/json"},body:JSON.stringify({content:msg})});const d=await r.json();typingIndicator.classList.add("hidden");typingIndicator.classList.remove("flex");if(d.success)addMessage(d.bot_message.content,"bot",getTimeString(),true)}catch(e){typingIndicator.classList.add("hidden");typingIndicator.classList.remove("flex")}}function addMessage(t,type,time,useTyping=false){const div=document.createElement("div");div.className="message-wrapper flex gap-4 max-w-4xl mx-auto w-full animate-fadeUp"+(type==="user"?" justify-end":"");if(type==="user"){div.innerHTML=`<div class="relative group"><div class="gradient-accent rounded-2xl rounded-tr-md p-5 max-w-xl"><p class="text-sm leading-relaxed">${t}</p><p class="text-[10px] text-white/50 mt-2 text-right">${time}</p></div></div><div class="w-10 h-10 rounded-xl gradient-accent flex items-center justify-center flex-shrink-0 font-bold shadow-lg">${userName}</div>`}else{const msgId="msg-"+Date.now();div.innerHTML=`<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 shadow-lg"><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg></div><div class="relative group"><div class="glass rounded-2xl rounded-tl-md p-5 max-w-xl"><p class="text-sm leading-relaxed" id="${msgId}">${useTyping?"":t}</p><p class="text-[10px] text-gray-500 mt-2 text-right">${time}</p></div><div class="reaction-btn absolute -bottom-3 left-4 flex gap-1 glass rounded-full px-2 py-1"><button onclick="react(this,'â¤ï¸')" class="hover:scale-125 text-sm">â¤ï¸</button><button onclick="react(this,'ğŸ‘')" class="hover:scale-125 text-sm">ğŸ‘</button><button onclick="react(this,'â­')" class="hover:scale-125 text-sm">â­</button><button onclick="react(this,'ğŸ™')" class="hover:scale-125 text-sm">ğŸ™</button></div></div>`;if(useTyping){setTimeout(()=>{const el=document.getElementById(msgId);if(el)typeMessage(el,t)},50)}}chatMessages.insertBefore(div,typingIndicator);scrollToBottom()}function loadChat(id){document.body.classList.add("page-exit");setTimeout(()=>{location.href="/chat/"+id+"/"},100)}document.addEventListener("click",function(e){if(!themePicker.contains(e.target)&&!e.target.closest("[onclick*='toggleThemePicker']"))themePicker.classList.add("hidden");if(!soundPicker.contains(e.target)&&!e.target.closest("[onclick*='toggleSoundPicker']"))soundPicker.classList.add("hidden");if(!emojiPicker.contains(e.target)&&!e.target.closest("[onclick*='toggleEmojiPicker']"))emojiPicker.classList.add("hidden")});scrollToBottom()</script></body></html>